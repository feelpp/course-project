= End-to-End Python Weather App Workshop
:page-tags: software-manual
:parent-catalogs: software:index
:page-illustration: fa-brands fa-python
:description: Build, package, test, containerize, and publish a Python weather app with an optional Dash interface.

[.lead]
This workshop extends the GitHub intro lab into a small end-to-end product: a Python package with a CLI, CI, Docker image, and optional web dashboard.

== Why This Session

Students already learned Linux, GitHub, GitHub Actions, and Docker. This session connects these topics into one coherent workflow:

- from raw data to reusable Python package
- from local script to installable CLI command
- from tested code to container image in GHCR
- optionally from CLI tool to interactive dashboard

== Prerequisites

- xref:git-github:github-review-projects-lab.adoc[GitHub Intro Lab: Issues, PRs, and Projects]
- xref:git-github:github-actions.adoc[GitHub Actions]
- xref:containers:docker/index.adoc[Docker Introduction]
- xref:software:package-managers.adoc[Package Managers]

== Learning Objectives

By the end of the workshop, students can:

- structure a Python project with `pyproject.toml`
- expose a CLI command via `[project.scripts]`
- run tests in CI for each pull request
- build and publish a Docker image to GitHub Container Registry (GHCR)
- explain the difference between package release and container release


== Session Formats

=== Option A: 60-minute session (overview + essential practice)

1. 10 min: Architecture and goals (package, CLI, CI, Docker, GHCR)
2. 15 min: `pyproject.toml` + package layout
3. 15 min: CLI command + one test
4. 10 min: CI workflow (run tests on PR)
5. 10 min: Docker build + push concept

=== Option B: 120-minute session (full hands-on)

1. 15 min: Architecture and delivery flow
2. 25 min: Python package and CLI scaffolding
3. 20 min: tests + local quality checks
4. 20 min: GitHub Actions workflow
5. 20 min: Docker + GHCR publish
6. 20 min: optional Dash app + wrap-up

== Target Project Structure

[source,text]
----
weather-app/
|-- pyproject.toml
|-- README.md
|-- src/
|   `-- weather_app/
|       |-- __init__.py
|       |-- cli.py
|       |-- analysis.py
|       `-- dash_app.py
|-- tests/
|   `-- test_analysis.py
|-- data/
|   `-- weather_hourly.csv
`-- Dockerfile
----

== Minimal `pyproject.toml`

`pyproject.toml` is the standard project manifest for modern Python packaging. It defines how the project is built, core metadata (name/version/dependencies), and entry points such as CLI commands. Package tools (`pip`, `build`, CI jobs, and publishing workflows) rely on this file.

[source,toml]
----
[build-system] # PEP 517 build configuration section.
requires = ["setuptools>=68", "wheel"] # Build-time packages needed to create sdist/wheel.
build-backend = "setuptools.build_meta" # Backend that implements the package build hooks.

[project] # Core package metadata used by installers and indexes.
name = "weather-app" # Distribution name users install with pip.
version = "0.1.0" # Initial semantic version for the package release.
description = "Mini weather analysis app for M1 course" # Short project summary shown in package metadata.
requires-python = ">=3.10" # Minimum Python interpreter version supported by the project.
dependencies = ["pandas>=2.0"] # Runtime dependencies installed with the package.

[project.scripts] # Console command entry points exported at installation time.
weather-cli = "weather_app.cli:main" # Creates `weather-cli` command mapped to weather_app.cli.main().
----

== CLI Scope (Required)

This is the first CLI for many students, so start from vocabulary and usage.

=== CLI Basics (Beginner)

A CLI (Command Line Interface) is a program you run from a terminal by typing a command.

Example structure:

- Program name: `weather-cli`
- Subcommand: `summary` (what action to run)
- Options: `--input`, `--start`, `--end` (parameters for the action)

Use help first:

[source,bash]
----
weather-cli --help
weather-cli summary --help
----

Recommended first run:

[source,bash]
----
python -m venv .venv
source .venv/bin/activate
pip install -e .
weather-cli --help
----

=== Expected Interface (v1)

Teams should implement at least the following interface:

[cols="2,3,5",options="header"]
|===
|Command |Options |Purpose

|`weather-cli summary`
|`--input`, `--start`, `--end`
|Compute summary metrics on a selected time range.

|`weather-cli check-data`
|`--input`
|Validate required columns, missing values, and timestamp conversion.

|`weather-cli plot` (optional)
|`--input`, `--metric`, `--output`
|Generate one figure (PNG) in `results/`.
|===

=== Minimum Command To Pass Workshop

[source,bash]
----
weather-cli summary --input data/weather_hourly.csv --start 2023-01-01 --end 2023-01-31
----

Expected output:

- number of rows used
- mean/min/max `temperature_2m`
- mean `relative_humidity_2m`
- max `wind_speed_10m`

=== Starter Framework (`src/weather_app/cli.py`)

Use this starter structure and fill in handlers gradually:

[source,python]
----
import argparse
from weather_app.analysis import summary_metrics, check_dataset


def build_parser() -> argparse.ArgumentParser:
    parser = argparse.ArgumentParser(prog="weather-cli", description="Weather analysis CLI")
    subparsers = parser.add_subparsers(dest="command", required=True)

    summary = subparsers.add_parser("summary", help="Compute summary metrics")
    summary.add_argument("--input", required=True, help="Path to weather CSV")
    summary.add_argument("--start", required=False, help="Start date YYYY-MM-DD")
    summary.add_argument("--end", required=False, help="End date YYYY-MM-DD")

    check = subparsers.add_parser("check-data", help="Validate input dataset")
    check.add_argument("--input", required=True, help="Path to weather CSV")

    return parser


def main() -> None:
    parser = build_parser()
    args = parser.parse_args()

    if args.command == "summary":
        result = summary_metrics(args.input, start=args.start, end=args.end)
        print(result)
    elif args.command == "check-data":
        report = check_dataset(args.input)
        print(report)


if __name__ == "__main__":
    main()
----

Interface expectation:

- `cli.py` handles user input and dispatching.
- `analysis.py` contains computation logic.
- Tests should target `analysis.py` first, then basic CLI behavior.

== CI/CD Scope (Required)

Workflow on pull requests:

- install dependencies
- run tests
- fail on regression

Workflow on tags (for example `v0.1.0`):

- build Docker image
- push to GHCR (for example `ghcr.io/org/weather-app:v0.1.0`)

== Optional Dash Extension

Add a small dashboard with:

- time-range selector
- temperature/humidity/wind plots
- one derived metric card (for example monthly mean temperature)

This should be optional for groups short on time.

== Team Expectations (2 vs 3 students)


Each student opens at least one PR and reviews at least one PR.

== Deliverables

1. Repository with `pyproject.toml` and working `weather-cli`
2. CI passing on main branch
3. Docker image published to GHCR
4. Short demo (3-5 minutes) of CLI workflow
5. Optional: running Dash app in container

== Suggested Follow-Up

- xref:visualisation:dash.adoc[Dash Tutorial]
- xref:software:repo/organization.adoc[Software Repository Organization]
